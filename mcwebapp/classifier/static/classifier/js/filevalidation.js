/**
 * This script contains the logic for validating a selected file and deciding
 * if it can be classified or not. This script relies on the onFileSet function
 * defined in the filebox.js script.
 */

/**
 * Called whenever the selected file is changed. Sends the file to the server
 * to check if the file can be classified.
 */
this.onFileSet = function(file) {
    
    // Read the file and upload the results to the server.
    fileReader = new FileReader();
    fileReader.onload = uploadFile;
    fileReader.readAsText(file, 'UTF-8');
}

/**
 * Called when the selected file is fully read. The parameter is the event
 * passed by the FileReader which contains the results. Sends a request to
 * the server to check the file's contents and see if the file is valid.
 */
function uploadFile(event) {
    
    // Get the results of the file reading.
    var result = event.target.result;
    
    // Send a request to the server to validate the file.
    data = {
        'contents': result
    };
    
    $.get('/validate', data).done(checkValidationResults);
}

/**
 * Called when the request to the server to check the selected file is
 * successfully completed. Checks whether or not the server deemed the
 * file as usable.
 */
function checkValidationResults(result) {
    console.log(result)
}