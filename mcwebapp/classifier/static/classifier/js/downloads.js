/**
 * This script contains functions for downloading specific portions of the result page.
 */

/**
 * Downloads the object at the specified URL as a file with the specified file name.
 */
function download(url, fileName) {
    
    // An object can be downloaded by creating an anonymous <a> element and simulating\
    // a click on it.
    var a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    a.click();
}

/**
 * Downloads the assembly view as a .asm file.
 */
function downloadAsmFile() {
    var asmString = $('#asm-view')[0].innerHTML;
    downloadText(asmString, 'Asm View.asm');
}

/**
 * Downloads the hex view as a .bytes file.
 */
function downloadHexFile() {
    var hexString = $('#hex-view')[0].innerHTML;    
    downloadText(hexString, 'Hex View.bytes');
}

/**
 * Downloads the image displayed in the #image element.
 */
function downloadImage() {
    var imageString = $('#image')[0].src;
    download(imageString, 'Image.png');
}

/**
 * Downloads the specified string as a plain text file with the specified file name.
 */
function downloadText(text, fileName) {
    
    // If the user is running windows, replace the text's line endings with Windows compatible
    // line endings.
    var windows = window.navigator.platform.includes('Win');
    if (windows)
        text = text.replace(/\n/g, '\r\n');
    
    // Encode the text and insert it into a base64 string.
    var base64String = 'data:text/plain;charset=utf-8,';
    base64String += encodeURIComponent(text);
    
    // Download the text.
    download(base64String, fileName);
}