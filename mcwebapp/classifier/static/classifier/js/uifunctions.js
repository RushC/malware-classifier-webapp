/**
 * This script contains functions for making changes to the UI elements in the
 * web page.
 */

// Set the default easing for animations to the FastInSlowOut easing function
// defined in Android for Material Design (I just think it looks nice...):
// 
// https://developer.android.com/reference/android/support/v4/view/animation/FastOutSlowInInterpolator.html
$.easing._default = $.bez([.04, 0, .2, 1]);

// The margin between cards (in pixels).
var cardMargin = 20;

/**
 * Hides the update log.
 */
function hideLog() {
    
    // Animate the update log up through the top of the screen.
    hideTop = -$('#update-log')[0].getBoundingClientRect().height;
    $('#update-log').animate({top: hideTop});
}

/**
 * Hides all of the tool buttons.
 */
function hideToolButtons() {
        
    // Animate the tool button card right behind the upload card.
    uploadCardRect = $('#upload-card')[0].getBoundingClientRect();
    hideTop = uploadCardRect.top;
    
    // Note: The z-index needs to be set immediately before the animation,
    //       otherwise it will not hide behind the upload card until after
    //       the animation completes. Still stupid. Still hate it.
    $('#tool-buttons-card').css({"z-index": -1}).animate({top: hideTop});
}

/**
 * Hides the upload card from view.
 */
function hideUploadCard() {
   
    // Animate the upload card and tool button card up through the top of the screen.
    hideTop = -$('#upload-card')[0].getBoundingClientRect().height
    $('#upload-card').css({position: 'absolute'}).animate({top: hideTop});
    $('#tool-buttons-card').animate({top: hideTop});
}

/**
 * Displays the specified results on the results cards and makes the card visible.
 */
function showResults(results) {
    
    // Class Card
    $('#class-name').html(results.ClassName);
    $('#class-description').html(results.ClassDescription);
    $('#class-link')[0].href = results.ClassLink;
    $('#confidence').html((results.Confidence * 100).toFixed(2) + '%');
    
    // Assembly View
    $('#asm-view-card').css({display: results.AsmView ? 'visible' : 'hidden'});
    $('#asm-view-card').html(results.AsmView)
    console.log('witf')
    
    // Hex View
    $('#hex-view-card').css({display: results.HexView ? 'visible' : 'hidden'});
    $('#hex-view').html(results.HexView);
    
    // Image
    $('#image-card').css({display: 'visible'});
    $('#image').attr('src', 'data:image/png;base64,' + results.Image);
    
    // Animate the results row into view.
    $('#results-row').css({display: 'block', opacity: 0, marginTop: 500})
                     .animate({opacity: 1, marginTop: 0});
}

/**
 * Shows all of the tool buttons.
 */
function showToolButtons() {
        
    // Animate the tool button card out from behind the upload card.
    uploadCardRect = $('#upload-card')[0].getBoundingClientRect();
    revealTop = uploadCardRect.top + uploadCardRect.height + cardMargin;
    
    // Note: If you don't set the z-index to above -1, the buttons will not be
    //       clickable. I don't know why. It's stupid and I hate it.
    $('#tool-buttons-card').animate({top: revealTop, "z-index": 0});
}

/**
 * Updates the title, text, and class of the #file-box. Only arguments that are
 * specified will be updated. Everything else will stay the same.
 */
function updateFileBox(title, text, cls) {
    
    // Change title/text.
    if (title) $('#file-box > .card-content > .card-title').html(title);
    if (text)  $('#file-box > .card-content > p').html(text);
    
    // Replace the last added class with the new class.
    if (cls) {
        lastClass = $('#file-box').attr('class').split(' ').pop();
        
        // Ensure we are not replacing the current class with itself.
        if (cls !== lastClass)
            $('#file-box').switchClass(lastClass, cls);
    }
}

/**
 * Adds the specified message to the update log.
 */
function updateLog(message) {
    
    // Add a hidden element containing the message to the update log.
    $('#update-log').append('<h5 style="margin-top: 100px; opacity: 0">' + message + '</h5>');
    
    // Animate the element to its non-hidden state.
    $('#update-log > h5').animate({marginTop: 0, opacity: 1});
}